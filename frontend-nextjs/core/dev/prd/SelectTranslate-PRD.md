# PRD：选中即翻译 小工具

- 文档版本：v1.0
- 目标平台：Windows 10/11（x64）
- 目标人群：重度阅读/资料检索/跨语开发者与学生
- 负责人：待定
- 发布节奏：MVP（热键版）→ 正式版（选中即弹出）→ 迭代增强

## 一、背景与目标
- 背景：腾讯电脑管家"划词翻译"下架，用户失去"选中即翻译"的轻量能力。
- 目标：
  - 在任何软件内选中文本，快速得到译文，尽量不打扰当前工作流。
  - 保持隐私安全、占用低、延迟小、部署简单。
- 成功定义：
  - 选中→得到译文全流程 ≤ 1.5 秒（云服务稳定时）
  - 误触率极低（自动弹出模式下 ≤ 1/100 次选择）
  - 剪贴板完整性不受影响（恢复率 ≥ 99%）

## 二、用户与场景
- 用户画像：
  - 开发者：阅读英文文档、Issue、论文
  - 学生与研究者：网页/论文/电子书阅读
  - 办公用户：邮件、网页、PDF 中的快速理解
- 核心场景：
  - 任意程序中选中一句话，马上获得翻译结果
  - 不想频繁打扰：只有按热键或轻点气泡时才翻译
  - 黑/白名单：在 IDE、密码框等敏感页面不触发

## 三、范围与边界
- 在范围：
  - 全局热键触发翻译（MVP）
  - 选中即出现"气泡"，点击后翻译（1.0）
  - 翻译接口：DeepL/LibreTranslate（二选一，支持切换）
  - 弹窗 UI：靠近鼠标位置，支持复制、固定、关闭
  - 设置面板（托盘）：语言、热键、黑白名单、开机自启、接口密钥
- 不在范围（后续考虑）：
  - 离线大模型翻译（GPU/体积大）
  - 全文/文件格式保留翻译
  - OCR（图片文字）与语音

## 四、功能需求

### v0.1 MVP（热键翻译）
- 全局热键（默认 Alt+T）：复制当前选区文本→翻译→在鼠标附近弹窗显示
- 自动语言检测，默认目标中文（可配置）
- 剪贴板保护：复制前保存文本剪贴板，结束后恢复
- 翻译供应商：默认 LibreTranslate；可配置 DeepL（API Key）
- 弹窗：显示译文，按钮"复制""关闭"；8 秒自动消失（可配置）
- 错误提示：网络异常、无选区、接口限额等

### v1.0（选中即弹出）
- 选区监听：鼠标左键抬起后，如存在选中文本，则在附近显示"气泡"
- 气泡内容：
  - 主按钮："翻译"
  - 快捷开关："本应用内自动翻译（记住选择）"
  - 次要按钮："复制原文""黑名单此程序"
- 自动翻译模式：针对"白名单/允许自动"的应用，选中后直接显示译文（不再二次点击）
- 托盘与设置：
  - 开/关：全局启用、选中即弹出
  - 热键设置、目标语言、供应商选择与 Key
  - 黑名单/白名单应用（按进程名）
  - 开机自启开关
  - 请求并发与速率限制（防止配额被刷）
- 缓存：对相同（文本+源/目标）返回命中（内存/可选本地）
- 回退策略：主供应商失败→尝试备选（可选）

### 通用功能
- 安全：API Key 仅本地保存，明文避免同步，提供"导入/清除"
- 国际化：设置面板与弹窗支持中/英
- 轻量更新：提供"检查更新"链接（手动下载）

## 五、非功能需求
### 性能与稳定
- 启动时间：≤ 1.5 秒
- 空闲占用：RAM ≤ 50 MB；CPU 空闲 ≤ 1%
- 单次翻译：接口响应 ≤ 800 ms（网络正常时），总呈现 ≤ 1.5 秒

### 可靠性
- 剪贴板恢复成功率 ≥ 99%
- 选中检测准确率 ≥ 95%

### 可用性
- 仅键盘操作可完成（热键翻译、关闭、复制）
- DPI 缩放 100%–200% 显示正常；深浅色模式跟随系统或可配置

### 隐私
- 默认不上传任何使用数据
- 原文仅在调用翻译接口时发送；可选"仅本地供应商"模式
- 日志默认关闭；开启时仅记录技术信息，不包含原文内容

## 六、交互与体验
### 触发路径
- MVP：选中文本 → Alt+T → "翻译中…" → 显示译文
- 1.0（自动气泡）：选中文本 → 出现气泡 → 点击"翻译"或已开启自动 → 显示译文

### 弹窗与气泡
- 出现位置：鼠标右下角，避免遮挡选区
- 动效：淡入/淡出，8 秒自动关闭（悬停暂停）
- 操作：
  - 复制译文
  - 复制原文（1.0）
  - 置顶（Pin），用于连看多条

### 失败与重试
- 清晰提示（网络/额度/密钥）
- 一键重试或切换备用供应商

## 七、技术方案与系统设计
### 模块
- 选区捕获与热键模块：复制选区、恢复剪贴板、监听鼠标/热键
- 翻译服务模块：供应商 SDK/HTTP 封装，自动检测、缓存、回退
- 弹窗 UI 模块：鼠标附近浮层、样式/主题、交互
- 设置与托盘模块：状态管理、持久化、开机自启、黑白名单

### 技术选型（Rust 版本）
- **核心语言**：Rust 1.70+
- **UI 框架**：
  - MVP：egui（轻量原生）或 Tauri（Web 技术栈）
  - 1.0：保持一致，增加系统托盘集成
- **Windows 集成**：winapi/windows crates
- **打包**：cargo build --release（单文件，~3-15MB）
- **部署**：免安装 EXE，可选 MSI 安装包

### 性能优化（Rust 优势）
- 启动时间：≤ 0.5 秒（相比 Python 提升 3 倍）
- 内存占用：≤ 20 MB（相比 Python 提升 60%）
- CPU 占用：接近 0%（异步处理）

### 配置与存储
- 本地 JSON：`%APPDATA%/SelectTranslate/config.json`
- 字段：目标语言、热键、供应商、API Key、黑白名单、自动弹出开关、主题
- 缓存：内存 LRU（可选落盘）

### 启动与自启
- 注册表 `HKCU/Software/Microsoft/Windows/CurrentVersion/Run`（可切换）

### 更新
- 手动检查更新（链接到发布页）
- 后续可加静默自更（不在本期）

## 八、依赖与集成
### 翻译供应商
- DeepL（推荐，需 API Key，质量高）
- LibreTranslate（公共实例，轻量与演示；可自建以提升稳定）

### 系统权限
- 全局热键与鼠标监听（用户态即可）
- 无需管理员权限（自启选注册表需用户写入权限）

## 九、风险与对策
- 误触与打扰：默认"点击气泡后才翻译"，支持黑名单，提供快捷关闭
- 剪贴板污染：严格保存/恢复文本剪贴板；复杂富文本不可完全保证，提示用户
- 接口配额或抖动：缓存+速率限制+备用供应商
- 特殊程序拦截（游戏/安全软件）：黑名单默认包含常见全屏程序
- API Key 泄露：仅本地保存；不记录到日志；可一键清空

## 十、里程碑与计划
### 第1周：Rust MVP
- 全局热键监听（global-hotkey）
- 剪贴板操作与保护（clipboard-win）
- 基础翻译服务（reqwest + DeepL/LibreTranslate）
- 简单弹窗UI（egui 或 Tauri）
- 基础配置管理

### 第2-3周：完整功能
- 文本选择检测（Windows UI Automation）
- 系统托盘集成
- 设置界面
- 缓存机制
- 黑白名单

### 第4周：优化打包
- 性能调优
- 错误处理完善
- 单文件打包优化
- 安装包制作

## 十一、验收标准与测试用例（摘选）
### 功能
- 选中文本 → Alt+T → 1.5 秒内出现译文（网络正常）
- 复制前后剪贴板内容一致（非富文本）
- 自动气泡：Word、Chrome、Notepad++、VS Code 中均可稳定出现
- 黑名单添加后，在该程序内不再触发

### 性能
- 空闲 RAM ≤ 50 MB，CPU ≤ 1%
- 连续翻译 50 次内未出现卡死/崩溃

### 兼容
- DPI 125%/150% 显示正常
- 深色/浅色显示清晰

### 隐私
- 默认不开启日志；开启后不含原文与译文

### 失败处理
- 断网时提示清晰；恢复后可重试

## 十二、监控与日志（可选）
- 错误日志：仅技术栈错误（异常类型、请求失败码），不记录敏感内容
- 崩溃转储：可选本地保存
- 统计（默认关闭）：本地计数（调用次数/失败次数/平均时延）

## 十三、配置项清单（示例）
### 语言与翻译
- 目标语言：zh/en/ja/...（默认 zh）
- 自动源语言检测：开/关
- 供应商：DeepL/LibreTranslate
- API Key：输入/清除

### 触发与交互
- 全局热键：Alt+T（可改）
- 选中即弹出：开/关（默认关）
- 自动翻译（对白名单应用）：开/关
- 弹窗自动关闭时间：8s（1–30s）

### 黑白名单
- 黑名单应用进程：列表（默认含常见全屏/游戏）
- 白名单应用进程：列表（为空则不过滤）

### 系统
- 开机自启：开/关
- 主题：跟随系统/浅色/深色
- 日志：开/关（不记录文本）

## 十四、发布与安装
### 交付形式
单文件 EXE（免安装）；或简易安装包（带开机自启配置）

### 打包
- Python 版：PyInstaller 单文件；或 AutoHotkey 编译脚本
- C# 版：.NET 8 单文件 self-contained

### 系统要求
Windows 10/11，x64，网络（云翻译时） 