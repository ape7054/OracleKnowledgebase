---
title: å…¨æ ˆåº”ç”¨æ¶æ„è®¾è®¡
description: å‰åç«¯åˆ†ç¦»æ¶æ„ã€å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ã€æ•°æ®åº“è®¾è®¡åŸåˆ™ã€APIè®¾è®¡è§„èŒƒç­‰æ¶æ„è®¾è®¡æœ€ä½³å®è·µ
date: 2025-10-14
category: architecture
tags: [æ¶æ„è®¾è®¡, å¾®æœåŠ¡, APIè®¾è®¡, æ•°æ®åº“è®¾è®¡, æœ€ä½³å®è·µ]
author: Tech Showcase
---

# å…¨æ ˆåº”ç”¨æ¶æ„è®¾è®¡

æ·±å…¥æ¢è®¨ç°ä»£å…¨æ ˆåº”ç”¨çš„æ¶æ„è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µã€‚

## æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Client Layer                    â”‚
â”‚  Next.js 15 (React 19 + TypeScript)         â”‚
â”‚  - SSR/SSG æ··åˆæ¸²æŸ“                          â”‚
â”‚  - å®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†                             â”‚
â”‚  - UI ç»„ä»¶åº“ (shadcn/ui)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Reverse Proxy Layer                â”‚
â”‚  Nginx                                       â”‚
â”‚  - è´Ÿè½½å‡è¡¡                                   â”‚
â”‚  - SSL ç»ˆæ­¢                                   â”‚
â”‚  - é™æ€èµ„æºç¼“å­˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚      â”‚   Backend    â”‚
â”‚   Service    â”‚      â”‚   Service    â”‚
â”‚   (Next.js)  â”‚      â”‚   (Go + Gin) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Database   â”‚    â”‚  WebSocket   â”‚
            â”‚   (MySQL)    â”‚    â”‚    Hub       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å‰ç«¯æ¶æ„

### 1. ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ [locale]/          # å›½é™…åŒ–è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ page.tsx       # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ about/         # å…³äºé¡µé¢
â”‚   â”‚   â””â”€â”€ knowledge/     # æ–‡æ¡£é¡µé¢
â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â””â”€â”€ globals.css        # å…¨å±€æ ·å¼
â”œâ”€â”€ components/            # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ ui/               # UI åŸºç¡€ç»„ä»¶
â”‚   â””â”€â”€ ...               # ä¸šåŠ¡ç»„ä»¶
â”œâ”€â”€ config/               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰ Hooks
â”œâ”€â”€ lib/                  # å·¥å…·å‡½æ•°
â””â”€â”€ messages/             # å›½é™…åŒ–æ–‡æ¡ˆ
```

### 2. ç»„ä»¶è®¾è®¡åŸåˆ™

#### å•ä¸€èŒè´£åŸåˆ™

```tsx
// âŒ ä¸å¥½çš„è®¾è®¡
function UserDashboard() {
  // æ··åˆäº†æ•°æ®è·å–ã€ä¸šåŠ¡é€»è¾‘å’ŒUI
  const [users, setUsers] = useState([])
  const [loading, setLoading] = useState(false)
  
  useEffect(() => {
    fetchUsers().then(setUsers)
  }, [])
  
  return (/* å¤æ‚çš„ UI */)
}

// âœ… å¥½çš„è®¾è®¡
function UserDashboard() {
  const { users, loading } = useUsers()
  
  return <UserList users={users} loading={loading} />
}
```

#### ç»„ä»¶ç»„åˆ

```tsx
// ä½¿ç”¨ Compound Component Pattern
<Card>
  <CardHeader>
    <CardTitle>æ ‡é¢˜</CardTitle>
    <CardDescription>æè¿°</CardDescription>
  </CardHeader>
  <CardContent>
    å†…å®¹åŒºåŸŸ
  </CardContent>
  <CardFooter>
    <Button>æ“ä½œ</Button>
  </CardFooter>
</Card>
```

### 3. çŠ¶æ€ç®¡ç†ç­–ç•¥

```tsx
// æœåŠ¡ç«¯çŠ¶æ€ - ä½¿ç”¨ React Server Components
async function ProductList() {
  const products = await fetchProducts()
  return <ProductGrid products={products} />
}

// å®¢æˆ·ç«¯çŠ¶æ€ - ä½¿ç”¨ useState
'use client'
function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(c => c + 1)}>{count}</button>
}

// å…¨å±€çŠ¶æ€ - ä½¿ç”¨ Context
const ThemeContext = createContext<ThemeContextType>({})

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [theme, setTheme] = useState<'light' | 'dark'>('light')
  
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  )
}
```

## åç«¯æ¶æ„

### 1. åˆ†å±‚æ¶æ„

```go
// Handler Layer - å¤„ç† HTTP è¯·æ±‚
func (h *UserHandler) CreateUser(c *gin.Context) {
    var req CreateUserRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    user, err := h.service.CreateUser(req)
    if err != nil {
        c.JSON(500, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(200, user)
}

// Service Layer - ä¸šåŠ¡é€»è¾‘
func (s *UserService) CreateUser(req CreateUserRequest) (*User, error) {
    // éªŒè¯
    if err := s.validateUser(req); err != nil {
        return nil, err
    }
    
    // å¯†ç å“ˆå¸Œ
    hash, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost)
    if err != nil {
        return nil, err
    }
    
    // åˆ›å»ºç”¨æˆ·
    user := &User{
        Username:     req.Username,
        Email:        req.Email,
        PasswordHash: string(hash),
    }
    
    return s.repo.Create(user)
}

// Repository Layer - æ•°æ®è®¿é—®
func (r *UserRepository) Create(user *User) (*User, error) {
    if err := r.db.Create(user).Error; err != nil {
        return nil, err
    }
    return user, nil
}
```

### 2. ä¸­é—´ä»¶æ¶æ„

```go
func main() {
    router := gin.Default()
    
    // å…¨å±€ä¸­é—´ä»¶
    router.Use(CORSMiddleware())
    router.Use(LoggingMiddleware())
    router.Use(RecoveryMiddleware())
    
    // å…¬å¼€è·¯ç”±
    public := router.Group("/api")
    {
        public.POST("/auth/login", authHandler.Login)
        public.POST("/auth/register", authHandler.Register)
    }
    
    // éœ€è¦è®¤è¯çš„è·¯ç”±
    protected := router.Group("/api")
    protected.Use(AuthMiddleware(jwtSecret))
    {
        protected.GET("/profile", userHandler.GetProfile)
        protected.PUT("/profile", userHandler.UpdateProfile)
    }
}
```

## æ•°æ®åº“è®¾è®¡

### 1. æ•°æ®æ¨¡å‹è®¾è®¡

```go
// ç”¨æˆ·æ¨¡å‹
type User struct {
    gorm.Model
    Username     string    `gorm:"type:varchar(100);uniqueIndex;not null"`
    Email        string    `gorm:"type:varchar(100);uniqueIndex"`
    PasswordHash string    `gorm:"type:varchar(255);not null"`
    Profile      Profile   `gorm:"foreignKey:UserID"`
    Trades       []Trade   `gorm:"foreignKey:UserID"`
}

// äº¤æ˜“æ¨¡å‹
type Trade struct {
    ID        uint      `gorm:"primaryKey"`
    UserID    uint      `gorm:"not null;index"`
    Symbol    string    `gorm:"type:varchar(20);not null"`
    Type      string    `gorm:"type:varchar(10);not null"`
    Price     string    `gorm:"type:varchar(50);not null"`
    Amount    string    `gorm:"type:varchar(50);not null"`
    Status    string    `gorm:"type:varchar(20);default:'completed'"`
    CreatedAt time.Time
    UpdatedAt time.Time
}
```

### 2. ç´¢å¼•ä¼˜åŒ–

```go
// æ·»åŠ ç´¢å¼•
type Trade struct {
    UserID uint `gorm:"index"`                          // å•åˆ—ç´¢å¼•
    Symbol string `gorm:"index:idx_symbol_created"`     // å¤åˆç´¢å¼•
    CreatedAt time.Time `gorm:"index:idx_symbol_created"`
}

// å”¯ä¸€ç´¢å¼•
type User struct {
    Email string `gorm:"uniqueIndex"`
}
```

### 3. æŸ¥è¯¢ä¼˜åŒ–

```go
// é¢„åŠ è½½å…³è”æ•°æ®
db.Preload("Profile").Preload("Trades").Find(&users)

// é€‰æ‹©ç‰¹å®šå­—æ®µ
db.Select("id", "username", "email").Find(&users)

// åˆ†é¡µæŸ¥è¯¢
db.Offset(offset).Limit(limit).Find(&users)
```

## API è®¾è®¡è§„èŒƒ

### 1. RESTful API è®¾è®¡

```
GET    /api/users           # è·å–ç”¨æˆ·åˆ—è¡¨
GET    /api/users/:id       # è·å–å•ä¸ªç”¨æˆ·
POST   /api/users           # åˆ›å»ºç”¨æˆ·
PUT    /api/users/:id       # æ›´æ–°ç”¨æˆ·
DELETE /api/users/:id       # åˆ é™¤ç”¨æˆ·

GET    /api/users/:id/trades    # è·å–ç”¨æˆ·çš„äº¤æ˜“è®°å½•
POST   /api/users/:id/trades    # åˆ›å»ºäº¤æ˜“è®°å½•
```

### 2. å“åº”æ ¼å¼ç»Ÿä¸€

```go
// æˆåŠŸå“åº”
{
    "success": true,
    "data": {
        "id": 1,
        "username": "john"
    }
}

// é”™è¯¯å“åº”
{
    "success": false,
    "error": {
        "code": "INVALID_INPUT",
        "message": "ç”¨æˆ·åå·²å­˜åœ¨"
    }
}

// åˆ†é¡µå“åº”
{
    "success": true,
    "data": [...],
    "pagination": {
        "page": 1,
        "limit": 20,
        "total": 100
    }
}
```

### 3. ç‰ˆæœ¬æ§åˆ¶

```go
// URL ç‰ˆæœ¬æ§åˆ¶
/api/v1/users
/api/v2/users

// Header ç‰ˆæœ¬æ§åˆ¶
Accept: application/vnd.api+json;version=1
```

## å®‰å…¨æ¶æ„

### 1. è®¤è¯å’Œæˆæƒ

```go
// JWT è®¤è¯
type Claims struct {
    UserID uint   `json:"user_id"`
    Role   string `json:"role"`
    jwt.RegisteredClaims
}

// RBAC æˆæƒ
func RequireRole(role string) gin.HandlerFunc {
    return func(c *gin.Context) {
        userRole, _ := c.Get("role")
        if userRole != role {
            c.JSON(403, gin.H{"error": "Forbidden"})
            c.Abort()
            return
        }
        c.Next()
    }
}
```

### 2. è¾“å…¥éªŒè¯

```go
type CreateUserRequest struct {
    Username string `json:"username" binding:"required,min=3,max=50"`
    Email    string `json:"email" binding:"required,email"`
    Password string `json:"password" binding:"required,min=8"`
}
```

### 3. å®‰å…¨å¤´éƒ¨

```nginx
add_header X-Frame-Options "SAMEORIGIN";
add_header X-Content-Type-Options "nosniff";
add_header X-XSS-Protection "1; mode=block";
add_header Strict-Transport-Security "max-age=31536000";
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å‰ç«¯ä¼˜åŒ–

- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- å›¾ç‰‡ä¼˜åŒ–ï¼ˆNext.js Imageï¼‰
- SSR/SSG æ··åˆæ¸²æŸ“
- CDN åŠ é€Ÿé™æ€èµ„æº

### 2. åç«¯ä¼˜åŒ–

- æ•°æ®åº“è¿æ¥æ± 
- Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- goroutine å¹¶å‘å¤„ç†
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

### 3. ç½‘ç»œä¼˜åŒ–

- Gzip å‹ç¼©
- HTTP/2
- æŒä¹…è¿æ¥
- è´Ÿè½½å‡è¡¡

## æ€»ç»“

è‰¯å¥½çš„æ¶æ„è®¾è®¡åº”è¯¥ï¼š

- ğŸ¯ **æ¸…æ™°çš„åˆ†å±‚**ï¼šèŒè´£æ˜ç¡®ï¼Œæ˜“äºç»´æŠ¤
- ğŸ“¦ **æ¨¡å—åŒ–**ï¼šé«˜å†…èšï¼Œä½è€¦åˆ
- ğŸ”’ **å®‰å…¨æ€§**ï¼šå¤šå±‚é˜²æŠ¤ï¼Œçºµæ·±é˜²å¾¡
- âš¡ **é«˜æ€§èƒ½**ï¼šåˆç†çš„ç¼“å­˜å’Œä¼˜åŒ–ç­–ç•¥
- ğŸ”„ **å¯æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- ğŸ›¡ï¸ **å®¹é”™æ€§**ï¼šä¼˜é›…çš„é”™è¯¯å¤„ç†

æŒæ¡è¿™äº›åŸåˆ™ï¼Œä½ å°±èƒ½è®¾è®¡å‡ºä¼˜ç§€çš„å…¨æ ˆåº”ç”¨æ¶æ„ï¼

